<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  <title>Gallery | Hikki Photography</title>

  <!-- Canonical -->
  <link rel="canonical" href="https://hikki.ca/gallery.html"/>

  <!-- 基本 SEO -->
  <meta name="description" content="Hikki Photography gallery — weddings, portraits, pets and cities across Vancouver, Hong Kong and Macau. Honest, human, emotional photography."/>
  <meta name="robots" content="index,follow,max-image-preview:large"/>

  <!-- Open Graph -->
  <meta property="og:type" content="website"/>
  <meta property="og:site_name" content="Hikki Photography"/>
  <meta property="og:title" content="Gallery | Hikki Photography"/>
  <meta property="og:description" content="Weddings, portraits, pets and cities — honest, human, emotional photography."/>
  <meta property="og:url" content="https://hikki.ca/gallery.html"/>
  <meta property="og:image" content="https://hikki.ca/g1_vancouver_prewedding_cityview.webp"/>
  <meta property="og:image:type" content="image/webp"/>

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image"/>
  <meta name="twitter:title" content="Gallery | Hikki Photography"/>
  <meta name="twitter:description" content="Weddings, portraits, pets and cities — honest, human, emotional photography."/>
  <meta name="twitter:image" content="https://hikki.ca/g1_vancouver_prewedding_cityview.webp"/>

  <!-- 預連線：加速載入 CDN -->
  <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>

  <!-- GSAP，用於文字淡入淡出與進場動畫 -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>

  <style>
    html { scroll-behavior: smooth; }
    body {
      margin: 0;
      padding: 0;
      font-family: "Courier New", monospace;
      background: #000;
      color: #000;
    }

    /* —— Mobile Rotator（手機版上方輪播列） —— */
    .mobile-rotator{
      position: fixed; top: 0; left: 0;
      width: 100%; height: 36px;
      background: #f4f2f0; color:#000;
      display: none; /* 僅手機顯示 */
      align-items: center; justify-content: center;
      padding: 0 12px; box-sizing: border-box;
      z-index: 10001; /* 高於 header(9999)，低於 overlay */
      font-size: 14px; line-height: 1;
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
      font-family: "Courier New", monospace;
    }
    .mobile-rotator.ja { font-family: "MS Mincho", serif; }

    /* —— Header Bar —— */
    .header-bar {
      position: fixed; top: 0; left: 0;
      width: 100%; height: 60px;
      background: #f4f2f0;
      display: flex; align-items: center;
      padding: 0 40px; box-sizing: border-box;
      z-index: 9999;
    }
    .header-title {
      margin-right: auto; font-size: 18px;
      overflow: hidden; white-space: nowrap;
      font-family: "Courier New", monospace;
      will-change: transform, opacity;
    }
    .header-title.ja { font-family: "MS Mincho", serif; }
    .header-bar a {
      margin-left: 40px; font-size: 18px;
      color: #000; text-decoration: none;
      transition: color .3s ease;
    }
    .header-bar a:hover  { color: #f1c232; }
    .header-bar a.active { color: #e74c3c; }

    /* —— 內容避開固定 Header —— */
    .header-spacer { height: 60px; }

    /* —— Filter Bar（獨立，字體 Courier New） —— */
    .filter-bar{
      width: 100%;
      background: #000;
      border-bottom: 1px solid #000;
      display: flex; align-items: center; gap: 10px;
      padding: 10px 40px; box-sizing: border-box;
      overflow-x: auto; -webkit-overflow-scrolling: touch;
      font-family: "Courier New", monospace;
      position: sticky; top: 60px; z-index: 5; /* 讓 Filter 跟隨在 Header 下方 */
    }
    .filter-label{
      font-size: 14px; color:#f4f2f0; margin-right: 8px;
      white-space: nowrap; user-select: none;
      font-family: "Courier New", monospace;
    }
    .filter-btn{
      appearance: none;
      border: 1px solid #f4f2f0;
      background: #fff; color:#222;
      padding: 6px 12px; font-size: 14px;
      border-radius: 999px; cursor: pointer;
      transition: background .2s ease, color .2s ease, border-color .2s ease, transform .05s ease;
      white-space: nowrap; font-family: "Courier New", monospace;
    }
    .filter-btn:hover { background:#f4f2f0; border-color:#f4f2f0; }
    .filter-btn:active{ transform: translateY(1px); }
    .filter-btn.active{ background:#000; color:#f4f2f0; border-color:#e74c3c; }

    /* —— Gallery —— */
    .gallery-wrapper {
      max-width: 1200px;
      margin: 0 auto 20px;
      padding: 20px 10px 10px;
      box-sizing: border-box;
    }
    .gallery {
      display: flex; flex-wrap: wrap; gap: 10px; justify-content: center;
    }

    .gallery img {
      width: calc(25% - 10px);
      min-width: 200px;
      aspect-ratio: 2 / 3;      /* 保持既有比例呈現 */
      height: auto;
      object-fit: cover; object-position: center;
      background: #111;
      cursor: pointer;
      transition: transform .3s ease, opacity .2s ease;
      will-change: transform, opacity;

      /* 避免 CLS、仍保留你原來的進場基線（JS 會把第一批動畫打開） */
      content-visibility: auto;
      contain-intrinsic-size: 400px 267px;
      opacity: 0; transform: translateY(14px);
    }
    .gallery img:hover { transform: scale(1.03); }

    /* —— Load More —— */
    .load-more-wrap{
      display:flex; justify-content:center; padding:16px 0 32px;
    }
    .load-more-btn{
      appearance: none;
      border: 1px solid #f4f2f0;
      background: #000; color:#f4f2f0;
      padding: 10px 18px; font-size: 14px; border-radius: 999px;
      cursor: pointer;
      transition: background .2s ease, color .2s ease, border-color .2s ease, transform .05s ease;
      font-family: "Courier New", monospace;
    }
    .load-more-btn:hover { background:#111; }
    .load-more-btn:active{ transform: translateY(1px); }
    .no-results{
      color:#f4f2f0; text-align:center; padding: 24px 0;
      font-size:14px;
    }

    /* —— Overlay Lightbox —— */
    .overlay {
      position: fixed; inset: 0;
      width: 100vw; height: 100vh;
      background: rgba(0,0,0,0.9);
      display: none; justify-content: center; align-items: center; flex-direction: column;
      z-index: 10002; /* 高於 rotator & header */
    }
    .overlay img { max-width: 90%; max-height: 90%; } /* 保留原始比例顯示 */
    .close-btn {
      position: absolute; top: 20px; left: 20px;
      font-size: 28px; color: #f4f2f0; cursor: pointer; user-select: none;
    }

    /* —— RWD —— */
    @media (max-width: 768px) {
      .gallery img { width: calc(50% - 10px); }
      .filter-bar{ padding: 10px 16px; }
    }
    @media (max-width: 480px) {
      /* 顯示手機輪播列，並讓 header 下移 */
      .mobile-rotator{ display:flex; }
      .header-bar{ top: 36px; }
      .header-spacer{ height: 96px; } /* 36 + 60 */
      .header-title { display: none !important; }

      /* 手機：一列 4 張（保留你的設定） */
      .gallery {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 10px;
        justify-items: stretch;
      }
      .gallery img {
        width: 100%;
        min-width: 0;
      }
      /* Filter 也保持置頂貼齊 Header */
      .filter-bar{ top: 96px; position: sticky; }
    }

    /* —— 保留原手機導覽調整 —— */
    @media only screen and (max-width: 767px) {
      .header-title { display: none !important; }
      .header-bar { justify-content: center !important; }
      .header-bar a { margin: 0 37px !important; }
    }
  </style>

  <!-- JSON-LD（精簡版） -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "CollectionPage",
    "name": "Gallery | Hikki Photography",
    "url": "https://hikki.ca/gallery.html",
    "description": "Weddings, portraits, pets and cities — honest, human, emotional photography across Vancouver, Hong Kong and Macau.",
    "isPartOf": {
      "@type": "WebSite",
      "name": "Hikki Photography",
      "url": "https://hikki.ca"
    },
    "publisher": {
      "@type": "Organization",
      "name": "Hikki photography & philosophy",
      "url": "https://hikki.ca",
      "email": "will@hikki.ca"
    },
    "hasPart": {
      "@type": "ItemList",
      "itemListElement": [
        { "@type":"ImageObject", "contentUrl":"https://hikki.ca/g1_vancouver_prewedding_cityview.webp" },
        { "@type":"ImageObject", "contentUrl":"https://hikki.ca/g2_hongkong_art_skycraper.webp" },
        { "@type":"ImageObject", "contentUrl":"https://hikki.ca/g6_Portrait_film_Vintage.webp" },
        { "@type":"ImageObject", "contentUrl":"https://hikki.ca/g10_asia_brutalist_textures_black_and_white.webp" },
        { "@type":"ImageObject", "contentUrl":"https://hikki.ca/g24_Vinyl_slience_man_couple_wedding.jpg" },
        { "@type":"ImageObject", "contentUrl":"https://hikki.ca/g29_portrait_couple_classic_love_wedding.webp" },
        { "@type":"ImageObject", "contentUrl":"https://hikki.ca/g33_urban_cat_outdoor_owner.webp" },
        { "@type":"ImageObject", "contentUrl":"https://hikki.ca/g39_gilmore_monochrome_city_highrise_intimacy.webp" }
      ]
    }
  }
  </script>
</head>
<body>

  <!-- —— 手機版上方輪播列 —— -->
  <div class="mobile-rotator en" id="mobileRotator" aria-live="polite">
    Of time, souls and cities.
  </div>

  <!-- —— Header —— -->
  <div class="header-bar">
    <div class="header-title en" id="headerTitle">
      Of time, souls and cities.
    </div>
    <a href="index.html">About</a>
    <a href="gallery.html" class="active">Gallery</a>
    <a href="contact.html">Contact</a>
  </div>

  <!-- 讓內容避開固定 Header -->
  <div class="header-spacer" aria-hidden="true"></div>

  <!-- —— Filter Bar（獨立） —— -->
  <div class="filter-bar" role="toolbar" aria-label="Gallery Filters">
    <span class="filter-label"></span>
    <button class="filter-btn" data-filter="Souls"   aria-pressed="false">Souls</button>
    <button class="filter-btn" data-filter="Times"   aria-pressed="false">Times</button>
    <button class="filter-btn" data-filter="Cities"  aria-pressed="false">Cities</button>
    <button class="filter-btn" data-filter="Friends" aria-pressed="false">Friends</button>
  </div>

  <!-- —— Gallery Section —— -->
  <div class="gallery-wrapper" id="gallery">
    <div class="gallery">
      <!-- 支援多分類：data-cat="Times, Souls" 或 "Cities Friends" 都可以 -->
      <img src="g1_vancouver_prewedding_cityview.webp"  alt="Photo 1"  loading="lazy" decoding="async" data-cat="Times, Souls">
      <img src="g2_hongkong_art_skycraper.webp"         alt="Photo 2"  loading="lazy" decoding="async" data-cat="Cities">
      <img src="g3_portrait_with_orange_tabby.webp"     alt="Photo 3"  loading="lazy" decoding="async" data-cat="Friends">
      <img src="g4_black_and_white_dog_running.webp"    alt="Photo 4"  loading="lazy" decoding="async" data-cat="Friends">
      <img src="g5_pet_owner_Wheatfield_family_photo.webp"    alt="Photo 5"  loading="lazy" decoding="async" data-cat="Friends">
      <img src="g6_Portrait_film_Vintage.webp"          alt="Photo 6"  loading="lazy" decoding="async" data-cat="Souls">
      <img src="g7_Kerrisdale_moment_poverty.webp"      alt="Photo 7"  loading="lazy" decoding="async" data-cat="Cities">
      <img src="g8_macau_architecture_concrete.webp"    alt="Photo 8"  loading="lazy" decoding="async" data-cat="Cities">
      <img src="g9_oriental_confused_moment_misty.webp" alt="Photo 9"  loading="lazy" decoding="async" data-cat="Cities">
      <img src="g10_asia_brutalist_textures_black_and_white.webp" alt="Photo 10" loading="lazy" decoding="async" data-cat="Cities">
      <img src="g11_vancouver_kitsilano_lonely_fastfood.webp" alt="Photo 11" loading="lazy" decoding="async" data-cat="Cities">
      <img src="g12_Shelti_smile_field_vancouver.webp"  alt="Photo 12" loading="lazy" decoding="async" data-cat="Friends">
      <img src="g13_burnaby_wedding_dance_couple.webp"  alt="Photo 13" loading="lazy" decoding="async" data-cat="Times">
      <img src="g14_crane_poise_modern_construction.webp" alt="Photo 14" loading="lazy" decoding="async" data-cat="Cities">
      <img src="g15_macau_alley_market_dreams.webp"     alt="Photo 15" loading="lazy" decoding="async" data-cat="Cities">
      <img src="g16_redline_utility_core_noise_barrier.webp" alt="Photo 16" loading="lazy" decoding="async" data-cat="Cities">
      <img src="g17_wedding_photography_crew_victoria_BC.jpg" alt="Photo 17" loading="lazy" decoding="async" data-cat="Times">
      <img src="g18_courtyard_stillness_temple_bells.webp" alt="Photo 18" loading="lazy" decoding="async" data-cat="Cities">
      <img src="g19_macau_brutalist_facade_raw_concrete.webp" alt="Photo 19" loading="lazy" decoding="async" data-cat="Cities">
      <img src="g20_infrastructural_romance_deconstructivist_angles.webp" alt="Photo 20" loading="lazy" decoding="async" data-cat="Cities">
      <img src="g21_light_warm_nightime.webp"           alt="Photo 21" loading="lazy" decoding="async" data-cat="Cities">
      <img src="g22_sunset_burnaby_streets_respite.webp" alt="Photo 22" loading="lazy" decoding="async" data-cat="Cities">
      <img src="g23_wall_offset_grid_liminal_city.webp" alt="Photo 23" loading="lazy" decoding="async" data-cat="Cities">
      <img src="g24_Vinyl_slience_man_couple_wedding.jpg" alt="Photo 24" loading="lazy" decoding="async" data-cat="Times, Souls">
      <img src="g25_party_wedding_ccd_moment_souls.webp" alt="Photo 25" loading="lazy" decoding="async" data-cat="Times">
      <img src="g26_shelti_mountain_northvan_hiking.webp" alt="Photo 26" loading="lazy" decoding="async" data-cat="Friends">
      <img src="g27_dog_portrait_moment_capture_home.webp" alt="Photo 27" loading="lazy" decoding="async" data-cat="Friends">
      <img src="g28_wedding_black_and_white_emotion_momment_forgotten.webp" alt="Photo 28" loading="lazy" decoding="async" data-cat="Times">
      <img src="g29_portrait_couple_classic_love_wedding.webp" alt="Photo 29" loading="lazy" decoding="async" data-cat="Times, Friends">
      <img src="g30_moment_joy_caring_wedding.webp"     alt="Photo 30" loading="lazy" decoding="async" data-cat="Times, Friends">
      <img src="g31_portrait_oldschool_traitional_emotions.webp" alt="Photo 31" loading="lazy" decoding="async" data-cat="Times, Friends">
      <img src="g32_party_wedding_food_friendship.webp" alt="Photo 32" loading="lazy" decoding="async" data-cat="Times">
      <img src="g33_urban_cat_outdoor_owner.webp"       alt="Photo 33" loading="lazy" decoding="async" data-cat="Cities">
      <img src="g34_vow_wedding_preperation_moment.webp" alt="Photo 34" loading="lazy" decoding="async" data-cat="Times">
      <img src="g35_toss_wedding_wine_champaign_rose.webp" alt="Photo 35" loading="lazy" decoding="async" data-cat="Times">
      <img src="g36_adopted_stray_dog_mixed_rescued.webp" alt="Photo 36" loading="lazy" decoding="async" data-cat="Friends">
      <img src="g37_prefab_panels_ribbed_slab.webp"     alt="Photo 37" loading="lazy" decoding="async" data-cat="Cities">
      <img src="g38_late_capital_vistas_concrete_jungle_dream.webp" alt="Photo 38" loading="lazy" decoding="async" data-cat="Cities">
      <img src="g39_gilmore_monochrome_city_highrise_intimacy.webp" alt="Photo 39" loading="lazy" decoding="async" data-cat="Cities">
      <img src="g40_sound_wall_prefab_panels_west_end_beach_vancouver.webp" alt="Photo 40" loading="lazy" decoding="async" data-cat="Cities">
      <img src="g41_black_and_white_wedding_grand_dressing_timeless_breath.webp" alt="Photo 41" loading="lazy" decoding="async" data-cat="Times">
      <img src="g42_victoria_marketsquare_photographer_model_art_lens.webp" alt="Photo 42" loading="lazy" decoding="async" data-cat="Souls">
      <img src="g43_dog_disability_running_speed_moment.webp" alt="Photo 43" loading="lazy" decoding="async" data-cat="Friends">
      <img src="g44_shelti_cornfield_sun_outdoor_love.webp" alt="Photo 44" loading="lazy" decoding="async" data-cat="Friends">
      <img src="g45_blueberry_dog_korean_instragram.webp" alt="Photo 45" loading="lazy" decoding="async" data-cat="Friends">
      <img src="g46_portrait_dog_pet_german.webp"       alt="Photo 46" loading="lazy" decoding="async" data-cat="Friends">
      <img src="g47_neighbour_unexpected_pitbull_pet_nighttime.webp" alt="Photo 47" loading="lazy" decoding="async" data-cat="Friends">
      <img src="g48_elegant_dog_hunt_river_white.webp"  alt="Photo 48" loading="lazy" decoding="async" data-cat="Friends">
      <img src="g49_dog_portrait_mountain_vancouver_capilano_commercial_photoshoot.webp" alt="Photo 49" loading="lazy" decoding="async" data-cat="Friends">
      <img src="g50_window_light_portrait_shadow_play_leading_lines_symmetry_balance.webp" alt="Photo 50" loading="lazy" decoding="async" data-cat="Friends">
      <img src="g51_Macau_asian_concrete_jungle.webp"   alt="Photo 51" loading="lazy" decoding="async" data-cat="Cities">
      <img src="g52_macau_bay_darkness_wings_storm.webp" alt="Photo 52" loading="lazy" decoding="async" data-cat="Cities">
      <img src="g53_street_cat_store_memory_macau.webp" alt="Photo 53" loading="lazy" decoding="async" data-cat="Cities, Friends">
      <img src="g54_red_architecture_mong_kok_night_liminal_.webp" alt="Photo 54" loading="lazy" decoding="async" data-cat="Cities">
      <img src="g55_stairwell_geometry_window_building.webp" alt="Photo 55" loading="lazy" decoding="async" data-cat="Cities">
      <img src="g56_analog_portrait_chinatown_family_warm_vibe.jpg" alt="Photo 56" loading="lazy" decoding="async" data-cat="Times">
      <img src="g57_professional_camera_ginger_tabby_maine_coon_lens.webp" alt="Photo 57" loading="lazy" decoding="async" data-cat="Friends">
      <img src="g58_ceramics_sculpture_glaze_earthware_stoneware.webp" alt="Photo 58" loading="lazy" decoding="async" data-cat="Cities">
      <img src="g59_Westvan_beachside_social_photography_billboard.webp" alt="Photo 59" loading="lazy" decoding="async" data-cat="Cities">
      <img src="g60_street_barber_glimpse_vauged_eyes_warm.webp" alt="Photo 60" loading="lazy" decoding="async" data-cat="Cities">
      <img src="g61_japanese_girl_cat_main_coon_playing.webp" alt="Photo 61" loading="lazy" decoding="async" data-cat="Friends">
      <img src="g62_straydog_adoption_leash_dogwalk_petphoto.webp" alt="Photo 62" loading="lazy" decoding="async" data-cat="Friends">
      <img src="g63_mushroom_burnaby_product_photography_lighting_zoom.webp" alt="Photo 63" loading="lazy" decoding="async" data-cat="Cities">
      <img src="g64_eastvan_streetview_silence_moment_sunlight.webp" alt="Photo 64" loading="lazy" decoding="async" data-cat="Cities">
      <img src="g65_stray_dog_leash_foster_family_photography_pet.webp" alt="Photo 65" loading="lazy" decoding="async" data-cat="Friends">
      <img src="g66_wheelchair_pet_owner_feeding_portrait.webp" alt="Photo 66" loading="lazy" decoding="async" data-cat="Friends">
      <img src="g67_dog_portrait_smile_capturing_moments.webp" alt="Photo 67" loading="lazy" decoding="async" data-cat="Friends">
      <img src="g68_dogs_playing_grooming_petphoto_evening.webp" alt="Photo 68" loading="lazy" decoding="async" data-cat="Friends">
    </div>

    <!-- Load More + 無結果訊息 -->
    <div class="load-more-wrap">
      <button id="loadMore" class="load-more-btn">Load More</button>
    </div>
    <div id="noResults" class="no-results" hidden>No images found.</div>
  </div>

  <!-- —— Overlay / Lightbox —— -->
  <div class="overlay" id="overlay">
    <span class="close-btn" id="closeBtn">×</span>
    <img src="" alt="Expanded Photo" id="overlayImg">
  </div>

  <!-- —— Header 動態文字輪播腳本 —— -->
  <script>
    const sentences = [
      "Of time, souls and cities.","Know thyself.","静かな光。",
      "10% off for rescued animals.","YYJ > YVR",
      "Get a quote today for free！",
      "絢爛如電 虛幻如霧","Wake the fuck up samurai-",
      "father Anderson...","also try max noodle house",
      "晚星墜落處，自成橋梁。",
      "Elegance is about breaking the rules.",
      "Hesitation is defeat",
      "賺菲林錢",
      "假作真時真亦假，無為有處有還無。",
      "死生契闊，與子成說。 ",
      "ネットは広大だわ。",
      "恥の多い生涯を送ってきました。",
      "Demain, dès l’aube…",
      "Je pense, donc je suis.",
      "Il faut imaginer Sisyphe heureux.",
      "Stay gold, Ponyboy.",
      "What’s in a name? that which we call a rose…",
      "I drink your milkshake!",
      "The horror! The horror!",
      "Le temps détruit tout.",
      "翩翩不富，皆失實也。",
      "雲上於天，需；君子以飲食宴樂。",
      "天下有山，遯。",
      "元者，善之長也；亨者，嘉之會也。",
      "男性は本質を愛し、女性は習慣を愛する。","い～や　い～や　い～や",
      "sksksk","Come on and join our convoy.","I am in flames!",
      "CBT is a lie, try Carl Jung.","Be your own reason to smile.",
      "其為質則金玉不足喻其貴。","写真は記憶だ。","影は真實を語る。",
      "빛은 거짓말하지 않아.","Light reveals. Shadow defines.",
      "Some people are worth melting for.","ひとりって切ないくらい自由。",
      "The name of the rose is all that remains.","Οἷ’ ἥβης ἄνθεα...*",
      "φαίνεταί μοι","(づ｡◕ ‿‿ ◕｡)づ　","(⁄ ⁄•⁄ω⁄•⁄ ⁄)♡",
      "Shanghai fog, yes.","悲喜千般同幻夢。","那些都是很好很好的，偏偏我不喜歡。"
    ];
    const headerEl = document.getElementById("headerTitle");
    const mobileEl = document.getElementById("mobileRotator");
    let lastIndex = -1;

    function rnd(exclude) { let i; do { i = Math.floor(Math.random() * sentences.length); } while (i === exclude); return i; }

    function applyText(el, text, isCJK){
      if(!el) return;
      el.classList.toggle("ja", isCJK);
      el.classList.toggle("en", !isCJK);
      el.textContent = text;
    }

    function animateHeader() {
      const next = rnd(lastIndex); lastIndex = next;
      const text = sentences[next];
      const isCJK = /[\u4E00-\u9FFF\u3040-\u30FF]/.test(text);

      [headerEl, mobileEl].filter(Boolean).forEach(t => {
        gsap.to(t, {
          y: -16, opacity: 0, duration: 0.25, ease: "power1.in",
          onComplete() {
            applyText(t, text, isCJK);
            gsap.set(t, { y: 16 });
            gsap.to(t, { y: 0, opacity: 1, duration: 0.35, ease: "power1.out" });
          }
        });
      });
    }
    animateHeader();
    setInterval(animateHeader, 4000);
  </script>

  <!-- —— Gallery + Filter + 動畫 + Load More（防抖動版） —— -->
  <script>
  (() => {
    const galleryEl = document.querySelector('.gallery');
    if (!galleryEl) return;

    // —— 基本節點 —— 
    const overlay    = document.getElementById('overlay');
    const overlayImg = document.getElementById('overlayImg');
    const closeBtn   = document.getElementById('closeBtn');

    const allImgs    = Array.from(galleryEl.querySelectorAll('img'));
    const filterBtns = document.querySelectorAll('.filter-btn');
    const loadMoreBtn= document.getElementById('loadMore');
    const noResults  = document.getElementById('noResults');

    // —— 動畫設定 —— 
    const reduceMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    const animateIn = (els) => {
      if (!els || !els.length) return;
      if (reduceMotion || !window.gsap) {
        els.forEach(el => { el.style.opacity = '1'; el.style.transform = 'none'; });
        return;
      }
      gsap.fromTo(els, { y:14, opacity:0 }, { y:0, opacity:1, duration:0.35, ease:'power2.out', stagger:0.04 });
    };

    // —— Lazy（安全：不再強制把 src 換透明圖；若已有 data-src 仍會讀取） —— 
    const io = new IntersectionObserver(entries => {
      entries.forEach(entry => {
        if (!entry.isIntersecting) return;
        const img = entry.target;
        if (img.dataset.src && img.src !== img.dataset.src) img.src = img.dataset.src;
        io.unobserve(img);
      });
    }, { rootMargin: '200px 0px' });
    allImgs.forEach(img => { if (img.dataset.src) io.observe(img); img.decoding = 'async'; });

    // —— 分頁 / 篩選 —— 
    const BATCH = 24;           // 一次載入更多
    let activeFilter = '';
    let visibleCount = BATCH;

    const splitCats = s => s.split(/[,|\s]+/).filter(Boolean);
    const parseCats = el => splitCats(el.dataset.cat || '');
    const getFilteredList = () => activeFilter ? allImgs.filter(img => parseCats(img).includes(activeFilter)) : allImgs;

    function refreshGrid(reset=false, origin='update'){
      const list = getFilteredList();
      if (reset) visibleCount = Math.min(BATCH, list.length);

      const toShow = list.slice(0, visibleCount);
      const showSet = new Set(toShow);
      const newlyShown = [];

      // 僅調整必要的元素，避免高度大幅變動造成回頂
      allImgs.forEach(img => {
        const shouldShow = showSet.has(img);
        const hidden = (img.style.display === 'none');
        if (shouldShow && hidden) {
          img.style.display = '';
          newlyShown.push(img);
          if (img.dataset.src) io.observe(img);
        } else if (!shouldShow && !hidden) {
          img.style.display = 'none';
        }
      });

      // 初次或切換篩選：直接對當前批次做進場；LoadMore：只對新顯示做進場
      const targets = (reset ? toShow : newlyShown);
      // 若無法動畫也要確保可見
      if (!targets.length) {
        if (reset) toShow.forEach(el => { el.style.opacity='1'; el.style.transform='none'; });
      } else {
        requestAnimationFrame(() => animateIn(targets));
      }

      // 控制 Load More 顯示
      loadMoreBtn.style.display = (visibleCount < list.length) ? 'inline-flex' : 'none';
      // 無結果
      noResults.hidden = list.length > 0;
    }

    // —— 初始渲染 —— 
    refreshGrid(true, 'init');

    // —— Load More：捲到新批第一張（避免回頂/抖動） —— 
    loadMoreBtn.addEventListener('click', () => {
      const list = getFilteredList();
      const oldCount = Math.min(visibleCount, list.length);
      visibleCount = Math.min(visibleCount + BATCH, list.length);
      const firstNew = list[oldCount];

      refreshGrid(false, 'more');

      if (firstNew) {
        const html = document.documentElement;
        const prev = html.style.scrollBehavior;
        html.style.scrollBehavior = 'auto'; // 暫停平滑以免彈跳
        firstNew.scrollIntoView({ block:'start' });
        const headerOffset = (window.innerWidth <= 480) ? (36 + 60 + 8) : 60; // rotator + header + 緩衝
        window.scrollBy({ top: -headerOffset, left: 0, behavior: 'auto' });
        html.style.scrollBehavior = prev || '';
      }
    });

    // —— Filter —— 
    filterBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        const wasActive = btn.classList.contains('active');
        filterBtns.forEach(b => { b.classList.remove('active'); b.setAttribute('aria-pressed','false'); });

        activeFilter = '';
        if (!wasActive) {
          btn.classList.add('active');
          btn.setAttribute('aria-pressed','true');
          activeFilter = btn.dataset.filter || '';
        }

        refreshGrid(true, 'filter');

        // 滾到圖牆頂緣（不是頁面最上），避免迷路
        const wrapTop = document.querySelector('.gallery-wrapper').getBoundingClientRect().top + window.scrollY;
        const headerOffset = (window.innerWidth <= 480) ? (36 + 60 + 8) : 60;
        window.scrollTo({ top: wrapTop - headerOffset, behavior: 'auto' });
      });
    });

    // —— Lightbox —— 
    allImgs.forEach(img => {
      img.addEventListener('click', () => {
        overlayImg.src = img.currentSrc || img.dataset.src || img.src;
        overlay.style.display = 'flex';
      });
    });
    closeBtn.addEventListener('click', () => overlay.style.display = 'none');
    document.addEventListener('keydown', e => { if (e.key === 'Escape') overlay.style.display = 'none'; });
  })();
  </script>
</body>
</html>
